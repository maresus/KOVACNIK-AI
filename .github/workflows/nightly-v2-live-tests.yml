name: Nightly V2 Live Tests

on:
  schedule:
    # Every night at 02:15 UTC
    - cron: "15 2 * * *"
  workflow_dispatch:

jobs:
  v2-live-suite:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    env:
      BASE_URL: ${{ vars.V2_BASE_URL != '' && vars.V2_BASE_URL || 'https://kovacnik-ai-production.up.railway.app' }}

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.13"

      - name: Install test deps
        run: |
          python -m pip install --upgrade pip
          pip install pytest httpx

      - name: Run comprehensive live suite (30 tests)
        run: |
          pytest -q tests/test_v2_comprehensive.py -v --base-url="$BASE_URL"
